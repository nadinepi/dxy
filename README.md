# Sequence divergence (dxy) between Sparrow populations
**Course**: BINP28  
**Author**: Nadine Pigida

## Project Overview
This project investigates patterns of genetic divergence between three sparrow populations. 

A reproducible Snakemake pipeline was developed to automate the entire workflow, from raw VCF filtering to statistical analysis and visualization.

## Repository Organization
The project directory is structured as follows:
- `data/`: Input directory (Requires VCF and GFF).
- `results/`: Contains intermediate output files generated by the pipeline.
- `results/figures/`: Destination for final plots, statistical summaries, and gene lists.
- `Snakefile`: The Snakemake workflow definition.
- `config.yaml`: Configuration parameters for filtering and window analysis.
- `final_analysis.R`: R script for statistical testing and visualization.

## Workflow Description
The analysis pipeline consists of three main stages:

1.  **Variant Filtering**: 
    - Quality control was performed using `bcftools` and `vcftools`.
    - The dataset was filtered to remove the outgroup (*Naxos2*) and retain only biallelic SNPs.
    - **Filtering Criteria**: 
        - Mean Sequencing Depth: 5-20x
        - Genotype Quality (GQ): >= 20
        - Maximum Missing Data: 10%
        - Minor Allele Frequency (MAF): >= 0.03
2.  **Divergence Analysis ($D_{XY}$)**: 
    - Absolute nucleotide divergence ($D_{XY}$) was calculated in **50kb non-overlapping windows** using `pixy`.
3.  **Statistical Analysis & Visualization**: 
    - An R script identifies outlier windows (Z-score > 3) and statistically compares divergence on the Z chromosome versus autosomes.
    - Specific attention is paid to a candidate inversion region on ChrZ

## Usage Instructions

### 1. Clone the Repository
Clone the project to your local environment:
```bash
git clone https://github.com/nadinepigida/dxy.git
cd dxy
```

### 2. Data Preparation
Ensure the following files are placed in the `data/` directory:
*   `ProjTaxa.vcf.gz` (Input VCF file)
*   `popmap.txt` (Included in repository)

### 3. Execute Pipeline
Run the full analysis using Snakemake:
```bash
snakemake --use-conda --cores 4
```
*(Note: Adjust the `--cores` argument according to available system resources).*

## Output Files
If successful, the `results/figures/` directory will contain:
1.  **Figure1_Genome_Dxy.pdf**: Genome-wide divergence plot highlighting significant outliers.
2.  **Figure2_ChrZ_Zoom_50kb.pdf**: Detailed view of the Z chromosome and the candidate inversion region.
3.  **statistics_summary.txt**: Statistical results (Wilcoxon rank sum test) comparing Z-chromosome and autosomal divergence.

## Biological Inference
There is a middle chunk of Chromosome Z (from about 10 Mb to 20 Mb) that looks different to the rest. We suspect this is a **chromosomal inversion** in the Lesina population that is stopping the populations from mixing their DNA in that specific spot. Outside of this inversion, on both the left and right sides, the patterns suggest that **introgression** has been happening between Lesina and K (where the populations are interbreeding and sharing genes). It seems the inversion is acting like a barrier, protecting that specific set of genes from being swapped.
